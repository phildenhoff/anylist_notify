version: '3.8'

services:
  anylist_notify:
    build: .
    container_name: anylist_notify
    restart: unless-stopped

    environment:
      # AnyList credentials
      - ANYLIST_EMAIL=${ANYLIST_EMAIL}
      - ANYLIST_PASSWORD=${ANYLIST_PASSWORD}

      # ntfy.sh configuration
      - NTFY_URL=${NTFY_URL:-https://ntfy.sh}
      - NTFY_TOPIC=${NTFY_TOPIC}

      # Database path (points to volume)
      - DATABASE_PATH=/data/anylist.db

      # Logging
      - RUST_LOG=${RUST_LOG:-info}

    volumes:
      # Persist SQLite database
      - ./data:/data

    # Health check (optional)
    healthcheck:
      test: ["CMD-SHELL", "test -f /data/anylist.db || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s
